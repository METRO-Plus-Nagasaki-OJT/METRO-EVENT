{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="{% static 'css/app.css' %}?{% now 'U' %}">
    <script defer src="{% static 'js/app.js' %}?{% now 'U' %}"></script>
</head>

<body>
    <div class="relative min-h-screen">
        <video id="webcam" hidden autoplay></video>
        <canvas id="canvas" class="absolute w-full h-full"></canvas>
        <div class="absolute w-full h-full p-5 flex flex-col justify-between">
            <div class="text-right">
                <button class="bg-blue-500 px-5 py-2 text-white rounded-[3px]">
                    Mode
                </button>
            </div>
            <div>
                <div x-data x-show="$store.reception.verify"
                    class="w-[300px] h-[300px]  py-5 px-20 space-y-5 text-white rounded-[5px] bg-opacity-50 bg-black flex flex-col justify-between items-center">
                    <div>Demo</div>
                    <div
                        class="w-[75px] h-[75px] bg-lime-500 rounded-full flex justify-center items-center">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24" class="size-14 fill-white">
                            <path fill-rule="evenodd"
                                d="M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div>Demo</div>
                </div>
            </div>
            <div>
            </div>
        </div>
    </div>
    <script>
        let webcamStream;
        let newWindow
        const canvas = document.getElementById("canvas")
        const context = canvas.getContext('2d');
        const video = document.getElementById('webcam');

        function startWebcam() {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    webcamStream = stream;
                    video.srcObject = stream;

                    setInterval(() => {
                        width = canvas.width = canvas.clientWidth;
                        height = canvas.height = canvas.clientHeight;
                        context.scale(-1, 1); // Flip the canvas horizontally
                        context.drawImage(video, -width, 0, width, height);
                        context.fillStyle = 'red'; // Set the color of the rectangle
                        context.fillRect(canvas.width - 50, canvas.height - 50, 50, 50);
                    }, 40)
                })
                .catch(error => {
                    console.error('Error accessing webcam:', error);
                });
        }

        function stopWebcam() {
            if (webcamStream) {
                webcamStream.getTracks().forEach(track => track.stop());
            }
        }
        startWebcam()

        document.addEventListener('alpine:init', () => {
            window.Alpine.store("reception", {
                verify: true
            })

            window.Alpine.store("reception", {
                verify: false
            })
        })

    </script>
</body>

</html>